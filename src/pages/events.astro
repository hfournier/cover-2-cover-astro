---
import { getCollection } from "astro:content"
import Panel from "../components/Panel.astro"
import BaseLayout from "../layouts/BaseLayout.astro"
import MainLayout from "../layouts/MainLayout.astro"
import { Image } from "astro:assets"
import Link from "../components/Link.astro"
import ButtonLink from "../components/ButtonLink.astro"

const title = "News | Classic Rock Dance Band | Cover2Cover | Kelowna, BC"
const description =
  "Want to know where we are playing next? Keep up to date with Kelowna's Classic Rock Dance Band news and calendar"

const events = await getCollection("events", ({ data }) => data.publish === true)
---

<BaseLayout {title} {description}>
  <MainLayout>
    <Panel>
      <div class="prose">
        <h1>Events</h1>
      </div>
      <div class="mt-4">
        {
          events.map((event) => (
            <article class="border-b-2 border-neutral-300 py-8 last:border-b-0 sm:grid sm:auto-rows-min sm:grid-cols-12 sm:gap-6">
              <div class="mb-4 sm:col-span-3 sm:mb-0 md:col-span-4 lg:col-span-5">
                <Image
                  class="not-prose aspect-3/2 w-full rounded-lg object-cover shadow-md"
                  src={event.data.photo}
                  alt=""
                />
              </div>
              <div class="mb-4 flex flex-col sm:col-span-9 sm:mb-0 md:col-span-8 lg:col-span-7">
                <h2 class="text-xl font-bold">
                  {event.data.eventLink ? (
                    <Link href={event.data.eventLink}>{event.data.title}</Link>
                  ) : (
                    event.data.title
                  )}
                </h2>
                <div>{event.data.venue}</div>
                <time class="font-bold" datetime={event.data.startDate.toISOString()}>
                  {event.data.startDate.toLocaleDateString("en-CA", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                    hour: "numeric",
                    minute: "2-digit"
                  })}
                </time>
                <div>
                  {Intl.NumberFormat("en-CA", { style: "currency", currency: "CAD" }).format(
                    event.data.price
                  )}
                </div>
                {event.data.ticketUrl && (
                  <div class="pt-2">
                    <ButtonLink href={event.data.ticketUrl} target="tickets">
                      Buy Tickets
                    </ButtonLink>
                  </div>
                )}
              </div>
              <p class="col-span-full" set:html={event.data.description} />
            </article>
          ))
        }
      </div>
    </Panel>
  </MainLayout>
</BaseLayout>
