---
import { YouTube } from "astro-embed"
import BaseLayout from "../layouts/BaseLayout.astro"
import MainLayout from "../layouts/MainLayout.astro"
import Panel from "../components/Panel.astro"
import { getCollection } from "astro:content"
import { Image } from "astro:assets"

const title = "Photo and video gallery | Dance Band | Cover2Cover | Kelowna, BC"
const description =
  "See photos of Kelowna's classic rock band in action. We have a lot of fun playing for crowds large and small!"

const photos = await getCollection("photos")
const videos = await getCollection("videos")
---

<BaseLayout {title} {description}>
  <MainLayout>
    <Panel>
      <div class="prose">
        <h1>Photo Gallery</h1>
      </div>
      <div>
        <template
          @imgmodal.window="imgModal = true; imgModalSrc = $event.detail.imgModalSrc; imgModalDesc = $event.detail.imgModalDesc;"
          x-if="imgModal"
        >
          <div
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 transform scale-90"
            x-transition:enter-end="opacity-100 transform scale-100"
            x-transition:leave="transition ease-in duration-300"
            x-transition:leave-start="opacity-100 transform scale-100"
            x-transition:leave-end="opacity-0 transform scale-90"
            class="bg-opacity-75 fixed inset-0 z-50 flex h-100 w-full items-center justify-center overflow-hidden bg-black p-2"
          >
            <div class="relative flex max-h-full max-w-3xl flex-col overflow-auto p-8">
              <button
                class="absolute top-0 right-0 z-50 outline-none focus:outline-none"
                tabindex="-1"
              >
                <svg
                  class="fill-current text-white"
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 18 18"
                >
                  <path
                    d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"
                  ></path>
                </svg>
              </button>
              <img :alt="imgModalSrc" class="h-[50vh] object-contain" :src="imgModalSrc" />
              <div class="absolute right-0 bottom-0 left-0 pb-2 text-center text-white"></div>
            </div>
          </div>
        </template>
      </div>
      <div class="my-8 grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
        {
          photos.map((photo) => (
            <div class="aspect-square max-h-fit w-full">
              <Image
                class="h-full w-full rounded-lg object-cover shadow-md transition-[scale] duration-500 ease-in-out hover:scale-110"
                src={photo.data.photo}
                alt={photo.data.caption}
                layout="constrained"
                loading="eager"
                decoding="async"
                fetchpriority="high"
              />
            </div>
          ))
        }
      </div>
    </Panel>
    <Panel>
      <div class="prose">
        <h2>Video Gallery</h2>
      </div>
      <div class="my-8 grid gap-4 md:grid-cols-2">
        {
          videos.map((video) => (
            <YouTube class="rounded-lg" id={video.data.videoId} title={video.data.title} />
          ))
        }
      </div>
    </Panel>
  </MainLayout>
</BaseLayout>
